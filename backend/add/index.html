<!DOCTYPE html>
<html lang="en">
<head>

	
	
	<meta charset="utf-8" /> <!-- Character encoding for the webpage -->
<meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- Required for Internet Explorer compatibility -->

<!-- Metadata for search engines -->
<title>Backend Add | Quizzatopia - Explore a World of Quizzes</title>
<meta name="generator" content="Quizzatopia" /> 
<meta name="description" content="Welcome to Quizzatopia - the ultimate destination for all your quizzing needs. Discover a world of quizzes like never before, ranging from fun trivia to professional exam preparation. With our user-friendly interface and extensive question bank, learning has never been more enjoyable. Join now to compete with others, earn points, and unlock achievements. Sign up, log in, and embark on your quizzing journey today!">
<meta itemprop="name" content="Quizzatopia">
<meta property="og:title" content="Quizzatopia - Explore a World of Quizzes">
<meta property="og:image" content="https://www.quizzatopia.com/images/logo.png">
<meta name="Distribution" content="Global" />
<meta name="Rating" content="General" />
<meta name="copyright" content="Quizzatopia">
<meta name="language" content="English">
<meta name="reply-to" content="quizzatopia@gmail.com">
<meta name="generator" content="Adobe Dreamweaver">
<meta name="Developer" content="Ron Wilson II">
<!-- Links to favicon images for various devices -->
<link rel="icon" sizes="192x192" href="/favicon.ico">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="icon" type="image/x-icon" href="/favicon.ico"> <!-- Alternate link to favicon image -->
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /> <!-- Required for mobile devices -->
<meta property="og:type" content="website">


	
<!-- Import navbar and footer components -->
  <link rel="import" href="/elements/navbar.html">
  <link rel="import" href="/elements/footer.html">



  <div id="navbar"></div>
  <!-- Rest of the page content -->
  <div id="signupLoginArea"><div>

  <!-- JavaScript dependencies async -->


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"  crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script  src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" ></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.3/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/js/bootstrap.min.js"></script>
	  	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">
	  	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>




  <!-- Firebase SDK -->
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <!-- Custom scripts -->
  <script  src="/main.js"></script> 
</head>

    
		
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    h1 {
      margin-bottom: 20px;
    }

    button {
      margin-bottom: 10px;
    }

    label {
      font-weight: bold;
      margin-right: 10px;
    }

    textarea {
      width: 100%;
      height: 200px;
      resize: vertical;
    }
  </style>
<body>


  <div class="container mt-4">

  <h1>JSON Fetch and Database</h1>
  
  <div>
    <label for="counterLabel">Counter:</label>
    <span id="counterLabel">0</span>
  </div>

  <button id="startButton" onclick="startFetching()">Start</button>
  <button id="stopButton" onclick="stopFetching()" disabled>Stop</button>
  <textarea id="log" rows="10" cols="50" readonly></textarea>

  <script>
let counter = 0;
let fetchInterval;
const logTextarea = document.getElementById('log');
const counterLabel = document.getElementById('counterLabel');
const startButton = document.getElementById('startButton');
const stopButton = document.getElementById('stopButton');

// Function to fetch JSON files and process data
async function startFetching() {
  startButton.disabled = true;
  stopButton.disabled = false;
  logTextarea.value = '';
  clearInterval(fetchInterval);
  fetchInterval = setInterval(fetchNextJSON, 1000);
}

// Fetch the next JSON file
async function fetchNextJSON() {
  counterLabel.textContent = counter;

  const url = `https://www.quizzatopia.com/q/New/q_${counter}_.json`;
  const response = await fetch(url);

  if (response.ok) {
    const quizInfo = await response.json();
    const quizName = quizInfo.quizName;
    const quizCode = quizInfo.quizCode;
    const numberOfQuestions = quizInfo.numberOfQuestions;
    const quizCategory = quizInfo.quizCategory;
    const quizDifficulty = quizInfo.quizDifficulty;
    const quizDescription = quizInfo.quizDescription;
    const quizTags = quizInfo.quizTags;

    const db = firebase.firestore();

    // Check if quiz already exists in Firestore
    const querySnapshot = await db.collection('quizzes').where('quizCodeDB', '==', quizCode).get();

    if (!querySnapshot.empty) {
      logTextarea.value += `Quiz with code ${quizCode} already saved.\n\n`;
      counter++;
      clearInterval(fetchInterval);
      fetchInterval = setInterval(fetchNextJSON, 1000);
    } else {
      let updateDate = new Date().toLocaleString();

      // Save quiz information to Firestore with an automatically generated document ID
      await db.collection('quizzes').doc(quizCode).set({
        quizCodeDB: quizCode,
        quizNameDB: quizName,
        quizCreatedByDB: "Quizzatopia",
        quizRatingDB: 0,
        imageURLDB: "https://www.quizzatopia.com/images/sq/_.png",
        quizJsonDB: `/q/New/q_${counter}_.json`,
        numberOfQuestionsDB: numberOfQuestions,
        quizTagsDB: quizTags,
        quizDescriptionDB: quizDescription,
        quizLinkDB: `/quiz/?e=New&q=q_${counter}_`,
        quizCategoryDB: quizCategory,
        quizCreatedDateDB: updateDate,
        quizDifficultyDB: quizDifficulty,
        quizFinishedCount: 0,
        quizStartedCount: 0 // Initialize the quizStartedCount to 0
      });

      console.log("Quiz data successfully saved with quiz code:", quizCode);

      const stringValues = `Quiz Name: ${quizName}\nQuiz Code: ${quizCode}\nNumber of Questions: ${numberOfQuestions}\nQuiz Category: ${quizCategory}\nQuiz Difficulty: ${quizDifficulty}`;

      console.log(stringValues);
      logTextarea.value += `JSON ${counter}: Adding: ${stringValues}\n\n`;
      counter++;
      clearInterval(fetchInterval);
      fetchInterval = setInterval(fetchNextJSON, 1000);
    }
  } else {
    logTextarea.value += `JSON ${counter}: Fetch failed\n`;
    stopFetching();
    counter++;
  }
}

// Stop fetching JSON files
function stopFetching() {
  clearInterval(fetchInterval);
  startButton.disabled = false;
  stopButton.disabled = true;
}

  </script>
    
    
    
    
    
    
       
	  </div>

  
	

    
  </body>
    </html>
