
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Challenge</title>
	
  <!-- Chart.js library   background-color: yellow; -->
  <script  src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="style.css">


  <!-- Import navbar and footer components -->
  <link rel="import" href="/elements/navbar.html">
  <link rel="import" href="/elements/footer.html">

  <div id="navbar"></div>
  <!-- Rest of the page content -->
  <div id="signupLoginArea"><div>

  <!-- JavaScript dependencies async -->


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"  crossorigin="anonymous">


  <script  defer src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.3/umd/popper.min.js"></script>

  <script  defer src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">
	  <script  defer src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/js/bootstrap.min.js"></script>

  <!-- Firebase SDK -->
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <!-- Custom scripts   <script  src="/main.js" defer></script> 
-->
  <script  src="/main.js" ></script> 
<style>

body {
  font-family: Arial, sans-serif;
}

h1 {
  text-align: center;
}

#challengeNumber,
#challengeResult {
  text-align: center;
  margin-bottom: 20px;
}

#shareButton,
#statsButton {
  display: block;
  margin: 0 auto;
  padding: 10px 20px;
  background-color: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

#shareButton:hover,
#statsButton:hover {
  background-color: #0056b3;
}

/* Popover Styling */
#popoverContainer {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
}

#popoverContent {
  background-color: #fff;
  padding: 20px;
  border-radius: 5px;
  box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.2);
  position: relative;
  max-width: 300px;
}

#closeButton {
  position: absolute;
  top: 5px;
  right: 5px;
  font-size: 20px;
  color: #333;
  background-color: transparent;
  border: none;
  cursor: pointer;
}

#closeButton:hover {
  color: #777;
}

ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

li {
  margin-bottom: 10px;
}

a {
  text-decoration: none;
  color: #007bff;
}

a:hover {
  color: #0056b3;
}



    .sent-cell {
      background-color: lightblue;
    }
    .received-cell {
      background-color: lightgreen;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid #ddd;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
  </style>

    
  </head>
<body>
  <!-- Add your HTML content here -->
  <h1>Quiz Challenge Page</h1>

 <h1>Quiz Challenge Details</h1>
  <p>Quiz Code: <span id="quizCode"></span></p>
  <p>Challenge Number: <span id="challengeNumber"></span></p>

<h1>Challenge Requests</h1>
  <div id="challengesContainer"></div>

	

  <script>

	  //start `https://quizzatopia.com/challenge/?${quizCode}&start`;

	/// request    `https://quizzatopia.com/challenge/?${quizCode}&${uID}`;


  // Function to read URL parameters
  function getURLParams() {
  const urlParams = window.location.href;
    return urlParams;
  }
document.addEventListener("DOMContentLoaded", function () {

    // Get the challenge number and quiz code from URL parameters
    const url = getURLParams();
console.log("url:", url);

	
const startIndex = url.indexOf('?') + 1; // Find the index of '?' character
const endIndex = url.indexOf('&', startIndex); // Find the index of '&' character after '?'
const quizCode = url.substring(startIndex, endIndex);

// Extract the challengeNumber
const challengeNumber = url.substring(endIndex + 1);

console.log("quizCode:", quizCode);
console.log("challengeNumber:", challengeNumber);
});


// Function to fetch and display challenge requests
function fetchAndDisplayChallenges(userID) {
  // Assuming you have a Firebase Firestore instance initialized
  const db = firebase.firestore();

  // Get a reference to the container where challenges will be displayed
  const challengesContainer = document.getElementById("challengesContainer");

  // Fetch challenge requests for the current user
  db.collection("challenges")
    .where("challengerID", "==", userID)
    .where("requesterID", "==", userID)
    .get()
    .then((querySnapshot) => {
      if (querySnapshot.empty) {
        // If no requests are displayed, start a challenge
        startChallenge(userID);
        return;
      }

      // Create an HTML table for the challenges
      let challengesTable = '<table>';
      challengesTable += '<thead><tr><th>Quiz Name</th><th>Request Date</th><th>Challenger</th><th>Actions</th></tr></thead><tbody>';

      // Iterate through the challenge requests
      querySnapshot.forEach((doc) => {
        const challengeData = doc.data();
        const challengeID = doc.id;

        // Define styles based on requester or challenger
        const cellStyle = challengeData.requesterID === userID ? "sent-cell" : "received-cell";

        // Add a row to the table
        challengesTable += `
          <tr class="${cellStyle}">
            <td>${challengeData.quizName}</td>
            <td>${challengeData.requestDate.toDate().toLocaleString()}</td>
            <td>${challengeData.challengerID}</td>
            <td><button onclick="acceptChallenge('${challengeID}','${challengeData.quizCode}')">Accept</button></td>
          </tr>`;
      });

      challengesTable += '</tbody></table>';

      // Update the challenges container with the table
      challengesContainer.innerHTML = challengesTable;
    })
    .catch((error) => {
      console.error("Error fetching challenges:", error);
    });
}



// Function to accept a challenge
function acceptChallenge(challengeID,quizCode) {
  // Accept the challenge
  // Add your logic here to accept a challenge or display a message
}












	  



// Function to generate a challenge URL
function generateChallengeURL(quizCode, challengeNumber) {
  return `https://quizzatopia.com/challenge/?quizCode=${quizCode}&challengeNumber=${challengeNumber}`;
}

// When the user selects friends and submits the form
document.getElementById("sendChallengeForm").addEventListener("submit", (event) => {
  event.preventDefault();

  // Get selected friends and other data from the form
  const selectedFriends = getSelectedFriends();
  const quizCode = "yourQuizCode"; // Replace with actual quiz code
  const challengeNumber = generateUniqueChallengeNumber(); // Generate a unique challenge number

  // Generate URLs for each friend and send them
  selectedFriends.forEach(friend => {
    const challengeURL = generateChallengeURL(quizCode, challengeNumber);
    sendChallengeToFriend(challengeURL, friend);
  });

  // Display success message or update UI
});




// Function to send a challenge URL to a friend
function sendChallengeToFriend(quizCode,challengeURL, challengerID) {
  // Assuming you have a Firebase Firestore instance initialized
  const db = firebase.firestore();

  // Define challenge data
  const quizCode = "yourQuizCode"; // Replace with actual quiz code
  const challengeNumber = generateUniqueChallengeNumber(); // Generate a unique challenge number
  const requestDate = new Date();
  const challengerID = "yourChallengerID"; // Replace with actual challenger ID

  // Fetch additional quiz information from the quizzes collection
  db.collection("quizzes")
    .doc(quizCode)
    .get()
    .then((quizDoc) => {
      if (quizDoc.exists) {
        const quizData = quizDoc.data();
        const quizName = quizData.quizName;
        const questionCount = quizData.numberOfQuestionsDB; // Assuming questions is an array in quizData

        // Add challenge data to the challenges collection
        db.collection("challenges").add({
          quizCode:quizCode,
          quizName:quizName,
          challengeNumber:challengeNumber,
          requestDate:requestDate,
          requesterID:uID,
	challengeStarted: false,	
          challengerID:challengerID,
          challengeDone: false, // Initial challenge status
          questionCount:questionCount, // Number of questions in the quiz
          // Add more relevant fields as needed
        })
        .then(() => {
          console.log("Challenge sent to friend successfully!");
        })
        .catch((error) => {
          console.error("Error sending challenge:", error);
        });
      } else {
        console.error("Quiz not found.");
      }
    })
    .catch((error) => {
      console.error("Error fetching quiz data:", error);
    });
}



fetchAndDisplayChallenges(userID);
	  
  </script>
</body>
</html>
