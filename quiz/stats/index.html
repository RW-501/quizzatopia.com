<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" /> <!-- Character encoding for the webpage -->
<meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- Required for Internet Explorer compatibility -->

<!-- Metadata for search engines -->
<title>Quiz Stat Page | Quizzatopia - Explore a World of Quizzes</title>
<meta name="generator" content="Quizzatopia" /> 
	
<meta name="description" content=" Discover a world of quizzes like never before, ranging from fun trivia to professional exam preparation.">

	<meta itemprop="name" content="Quizzatopia">
<meta property="og:title" content="Quizzatopia - Explore a World of Quizzes">
<meta property="og:image" content="https://www.quizzatopia.com/images/logo.png">
<meta name="Distribution" content="Global" />
<meta name="Rating" content="General" />
<meta name="copyright" content="Quizzatopia">
<meta name="language" content="English">
<meta name="reply-to" content="quizzatopia@gmail.com">
<meta name="generator" content="Adobe Dreamweaver">
<meta name="Developer" content="Ron Wilson II">
<!-- Links to favicon images for various devices -->
<link rel="icon" sizes="192x192" href="/favicon.ico">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/favicon.ico" type="image/x-icon"/>
<link rel="icon" type="image/x-icon" href="/favicon.ico"> <!-- Alternate link to favicon image -->
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /> <!-- Required for mobile devices -->
<meta property="og:type" content="website">

	
<meta property="og:description" content="Welcome to Quizzatopia - the ultimate destination for all your quizzing needs. Discover a world of quizzes like never before, ranging from fun trivia to professional exam preparation. With our user-friendly interface and extensive question bank, learning has never been more enjoyable. Join now to compete with others, earn points, and unlock achievements. Sign up, log in, and embark on your quizzing journey today!">
<meta name="keywords" content="quizzing, quizzes, learning, education, fun, trivia, exam preparation, sign up, log in, compete, points, achievements">
<meta property="og:url" content="https://www.quizzatopia.com">

	
<meta name="robots" content="index,follow">
	<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@Quizzatopia">
<meta name="twitter:title" content="Quizzatopia - Explore a World of Quizzes">
<meta name="twitter:description" content="Welcome to Quizzatopia - the ultimate destination for all your quizzing needs. Discover a world of quizzes like never before, ranging from fun trivia to professional exam preparation. With our user-friendly interface and extensive question bank, learning has never been more enjoyable. Join now to compete with others, earn points, and unlock achievements. Sign up, log in, and embark on your quizzing journey today!">
<meta name="twitter:image" content="https://www.quizzatopia.com/images/logo.png">
<meta name="twitter:url" content="https://www.quizzatopia.com">

<!-- Open Graph metadata for Facebook -->
<meta property="og:site_name" content="Quizzatopia">
<meta property="og:locale" content="en_US">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

<!-- Schema.org markup for Google+ -->
<meta itemprop="description" content="Welcome to Quizzatopia - the ultimate destination for all your quizzing needs. Discover a world of quizzes like never before, ranging from fun trivia to professional exam preparation. With our user-friendly interface and extensive question bank, learning has never been more enjoyable. Join now to compete with others, earn points, and unlock achievements. Sign up, log in, and embark on your quizzing journey today!">
<meta itemprop="image" content="https://www.quizzatopia.com/images/logo.png">


<!-- Canonical URL -->
<!-- <link rel="canonical" href="https://www.quizzatopia.com/quiz"> -->
 <link rel="canonical" href="https://www.quizzatopia.com/quiz/stats">

	
<!-- Author information -->
<meta name="author" content="Ron Wilson II">
<meta name="contact" content="quizzatopia@gmail.com">

<!-- Page-specific metadata -->
<meta name="subject" content="Quizzatopia Platform">
<meta name="topic" content="Quizzing, Education, Learning, Quizzes">
<meta name="geo.placename" content="Dallas, TX">
<meta name="geo.region" content="US-TX">

<!-- Language and content type -->
<meta name="content-language" content="en-US">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- Caching and expiration -->
<meta http-equiv="expires" content="Tue, 01 Jan 2024 00:00:00 GMT">
<!-- <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="pragma" content="no-cache"> -->
	

 <!-- Google AdSense code -->
 <!--  <script defer  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4968673576211489" crossorigin="anonymous"></script> -->

 <!-- Organization Schema -->
   <script type="application/ld+json">
  {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Quizzatopia",
  "description": "Quizzatopia is an online platform dedicated to providing a diverse range of quizzes for individuals of all ages and backgrounds.",
  "url": "https://www.quizzatopia.com",
  "logo": "https://www.quizzatopia.com/images/logo.png",
  "sameAs": [
    "https://twitter.com/Quizzatopia",
    "https://www.facebook.com/Quizzatopia",
    "https://www.linkedin.com/company/quizzatopia",
    "https://www.reddit.com/r/Quizzatopia",
    "https://www.youtube.com/@Quizzatopia/about",
    "https://www.tiktok.com/@quizzatopia",
    "https://www.instagram.com/Quizzatopia"
  ]
}
 </script>



    <!-- Blog Schema -->
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Blog",
        "name": "Quizzatopia Blog",
        "description": "The official blog of Quizzatopia, providing additional quiz-related content and insights.",
        "url": "https://quizzatopia.blogspot.com"
    }
 </script>

  

	  
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Quizzatopia",
  "url": "https://www.quizzatopia.com",
  "description": "Quizzatopia is an online platform dedicated to providing a diverse range of quizzes for individuals of all ages and backgrounds.",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.quizzatopia.com/quiz?q={search_term_string}",
    "query-input": "required name=search_term_string"
  },
  "sameAs": [
    "https://twitter.com/Quizzatopia",
    "https://www.facebook.com/Quizzatopia",
    "https://www.linkedin.com/company/quizzatopia",
    "https://www.reddit.com/r/Quizzatopia",
    "https://www.youtube.com/@Quizzatopia",
    "https://www.tiktok.com/@quizzatopia",
    "https://www.instagram.com/Quizzatopia"
  ]
}
</script>


	  
	  
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://www.quizzatopia.com"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Quizzes",
      "item": "https://www.quizzatopia.com/quizzes"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "About",
      "item": "https://www.quizzatopia.com/about"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Quiz",
      "item": "https://www.quizzatopia.com/quiz"
    }
  ]
}
</script>

	<style>

/* Add your custom styles here */

body {
  font-family: Arial, sans-serif;
  line-height: 1.6;
  margin: 0;
  padding: 0;
  width: 100%;

}

header {
  color: #333;
  text-align: center;
  padding: 1rem;
}

main {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
  width: 100%;

}

h1 {
  margin: 0;
}

.quiz-info {
    margin-bottom: 2rem;
    width: 100%;
    display: flex;
}
.retakeBtn {
    width: fit-content;
    display: block;
    margin-top: 20px;
    background-color: #fd7e14;
    border: none;
    margin-bottom: 15%;
    font-size: 1.5em;
    font-weight: 700;
    padding: 3%;
    color: white;
    text-align: center;
    border-radius: 1em;
    /* text-shadow: -4px 2px 0px #6b6a6a; */
    box-shadow: 3px 3px 0rem 3px #b98c03 !important;
    cursor: pointer;
}
.box {
    width: 80%;
}

		
h2 {
  margin-bottom: 1rem;
}

.stats {
  border-top: 1px solid #ddd;
  padding-top: 2rem;
}

footer {
  background-color: #333;
  color: #fff;
  text-align: center;
  padding: 1rem;
}

/* Add any additional styling as needed */




		/* Add this CSS to style the overlay and popup */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
}

.popup {

  text-align: center;

    background-color: #e7e7e7;
    padding: 5% 0 0 0;
    border-radius: 2em;
    margin: auto;
    top: 0;
    bottom: 0;
    position: absolute;
    width: 80%;
    height: 80%;
    overflow-y: clip;
    box-shadow: inset 0px 1px 0rem 14px #fd7e14 !important;
    display: block;
    overflow: hidden;
}
/* Add any additional styles for the buttons and other elements as needed */

.BottomCloseOptionsButton {
    width: 100%;
    background-color: #fd7e14;
    padding: 1%;
    border: none;
    font-size: 3em;
    font-weight: 800;
    color: white;
    box-sizing: border-box;
    bottom: 0;
    position: absolute;
    left: 0;
    right: 0;
    margin: auto;
    text-align: center;
}

.close:hover, .close:focus {
    color: #333;
    text-decoration: none;
    cursor: pointer;
}


#copyURL{
width: 70%;
    border: none;
    margin: 0;
    padding:  0;
    top: 0;
    bottom: 0;
    position: relative;
    font-size: 1.5em;
    font-weight: 700;
	    border-radius: 1.5em;
}
		
#shareURL {
    width: 80%;
	  border: none;
    margin: 0;
    padding: 2% 0;
    border-radius: 0;
	   top: 0;
    bottom: 0;
    left: 0;
    position: relative;
}
#copyButton{
    width: 20%;
	  border: none;
    margin: 0;
    padding: 2% 0;
    border-radius: 0;
	   top: 0;
    bottom: 0;
    right: 0;
    position: relative;
	background-color: #fd7e14;
	color:white;
}
		#shareButton{
width: 20%;
    border: none;
    margin: 0;
    padding:  0;
    top: 0;
    bottom: 0;
    position: relative;
    font-size: 1.5em;
    font-weight: 700;
	    border-radius: 1.5em;
		}

		.popup hr{
    width: 90%;

		}
#quizName{
    font-size: 1.5em;
    font-weight: 800;
}

.popup h2{
    font-size: 2em;
    font-weight: 900;
		}
.popup p{
    font-size: 1em;
    font-weight: 700;
		}
#bMC_link{
    width: 30%;
    margin: auto;

}
		#bMC_link img{
		width: 100%;
		}

		
/* Add some styling for the quiz summary cards */
.quiz-summary-card {
  margin-bottom: 20px;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 10px;
  background-color: #f8f9fa;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.quiz-summary-card h5 {
  margin-bottom: 10px;
  font-weight: bold;
}

.quiz-summary-card p {
  margin-bottom: 5px;
}

.quiz-summary-card p:last-child {
  margin-bottom: 0;
}

/* Additional styling for the table if needed */
.table {
  margin-bottom: 30px;
}

.incorrect{
background-color: #fb505099;
}
.correct{
background-color: #7afb5099;
}

.attempt1{
    background-color: #5065fb99  !important;
}
.attempt2{
background-color: #f850fb99  !important;
}
.attempt3{
background-color: #fbe65099 !important;
}
.num1{
    width: 10%;
}
.num2{
    width: 60%;
word-wrap: break-word;
    text-align: center;
}
.num3{
    width: 20%;
}
.num4{
    width: 20%;
}
.quiz-summary-card{
    cursor: pointer;

}




.popup-container {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
}

.popup-content {
  background-color: white;
  padding: 20px;
  border-radius: 5px;
}

#questionTableBody{
    cursor: pointer;
}
	</style>
	  	
	
	
	
  <!-- Chart.js library -->
  <script  src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">

  <!-- Custom CSS -->
 <!--  <link rel="stylesheet" href="/style.css">-->

	
  <!-- Import navbar and footer components -->
  <link rel="import" href="/elements/navbar.html">
  <link rel="import" href="/elements/footer.html">

  <div id="navbar"></div>
  <!-- Rest of the page content -->
  <div id="signupLoginArea"><div>

  <!-- JavaScript dependencies async -->


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"  crossorigin="anonymous">


  <script  defer src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.3/umd/popper.min.js"></script>

  <script  defer src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">
	  <script  defer src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.2/js/bootstrap.min.js"></script>

  <!-- Firebase SDK -->
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script  src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <!-- Custom scripts   <script  src="/main.js" defer></script>  -->
  <script  src="/main.js" ></script> 

	  </head>
	  <!-- Google Tag Manager -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9VG78SV9KZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-9VG78SV9KZ');
	  
	//  console.log('page loading??/ mmmmm???????????????????????????????:');
	  
  </script>

  <!-- Google AdSense -->

	
<body>

   <header>
    <h1>Quiz Stat Page</h1>
  </header>
  <main>
    <div class="quiz-info">
    <div class="box">
      <h2>Quiz Information</h2>
      <p><strong>Quiz Name:</strong> <span id="quizName"></span></p>
      <p><strong>Quiz Code:</strong> <span id="quizCode"></span></p>
      <p><strong>Number of Questions:</strong> <span id="numQuestions"></span></p>
      <p><strong>Total Attempts:</strong> <span id="totalAttempts"></span></p>
      <p><strong>Best Score:</strong> <span id="bestScore"></span></p>

    </div>
            <div class="container">
		    <button class="retakeBtn" class=" " onclick="takeQuiz()" >Take Quiz </button><br>

            <button class="retakeBtn" class=" " onclick="startChallegeFunc()" >Start Challenge</button>
	    </div>
    </div>

    <div class="stats">
      <h2>Quiz Statistics</h2>

      <div class="row">

     <div class="quiz-summary">
  <!-- Quiz summary cards will be dynamically added here -->
</div>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Question Number</th>
      <th>Question</th>
      <th>Response Time</th>
      <th>Correctness</th>
    </tr>
  </thead>
  <tbody id="questionTableBody">
    <!-- This table will be populated dynamically using JavaScript -->
  </tbody>
</table>

        </div>
     
    </div>

    <div id="bMC_link">
      <a href="https://www.buymeacoffee.com/Quizzatopia" target="_blank"><img src="/images/bmc.png" alt="Buy Me A Coffee" id="adPic" ></a>
    </div>
  </main>

	
<div id="popupContainer" class="popup-container">
  <div id="popupContent" class="popup-content">
    <!-- Content of the popup, answers will go here -->
    <button id="closeButton">Close</button>
  </div>
</div>

<!-- Button to trigger the popup -->

	  <!-- Chart.js <script src="script.js" defer></script> library -->
	  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	  <script>

		  
	// Assuming you have a popupContainer and popupContent in your HTML
const popupContainer = document.getElementById('popupContainer');
const popupContent = document.getElementById('popupContent');

// Close button functionality for the popup
const closeButton = document.getElementById('closeButton');
closeButton.addEventListener('click', () => {
  popupContainer.style.display = 'none';
});

		  
var quizLink;


  // Get the quiz code from the URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const quizCode = urlParams.get('q');

function takeQuiz(){
window.location.href = quizLink;

}
		  
  // Wrap the code inside the DOMContentLoaded event listener
  document.addEventListener('DOMContentLoaded', function() {
    if (quizCode) {
      console.log('Quiz: ' + quizCode);
      // Call the function to fetch and display quiz data and statistics
      fetchQuizDataAndStats(quizCode);
    } else {
      // Open the main page if the quiz code is not available
      // window.open("https://www.quizzatopia.com/", "_blank");
    }
  });

  // Get reference to Firestore database
  const db = firebase.firestore();
      var reviewDataDocs = [];
		  
    // Function to fetch quiz review data
function getQuizReviewData(quizCode, userID) {
  const quizReviewDataRef = db.collection('quizReviewData');
  return quizReviewDataRef
    .where('quizCode', '==', quizCode)
    .where('userID', '==', userID) // Use the passed userID parameter here
    .get()
    .then(querySnapshot => {
      if (querySnapshot.empty) {
        // Quiz review data with the given quizCode and userID not found
        console.log('Quiz review data not found');
        return [];
      }
      // Array to store multiple reviewDataDocs
      querySnapshot.forEach(doc => {
        reviewDataDocs.push(doc.data());
    console.log("reviewDataDocs:", reviewDataDocs);

      });
      return reviewDataDocs;
    })
    .catch(error => {
      console.error('Error fetching quiz review data:', error);
      return null;
    });
}

	function startChallegeFunc(){
		
  window.location.href =  `https://quizzatopia.com/challenge/?${quizCode}&start`;

	  }


    // Function to fetch quiz data
    function getQuizData(quizCode) {
      const quizzesRef = db.collection('quizzes');
      return quizzesRef.where('quizCodeDB', '==', quizCode).get()
        .then(querySnapshot => {
          if (querySnapshot.empty) {
            // Quiz with the given code not found
            console.log('Quiz not found getQuizData');
            return null;
          }
          // Assuming quizCode is unique, there should be only one document in the querySnapshot
          const quizDoc = querySnapshot.docs[0].data();
          return quizDoc;
        })
        .catch(error => {
          console.error('Error fetching quiz data:', error);
          return null;
        });
    }



    // Function to display quiz information and statistics
    function displayQuizStats(quizDoc, reviewDataDoc) {
      // Populate the quiz information in the page
      document.getElementById('quizName').textContent = quizDoc.quizNameDB;
      document.getElementById('quizCode').textContent = quizDoc.quizCodeDB;
      document.getElementById('numQuestions').textContent = quizDoc.numberOfQuestionsDB;
      // Add other quiz information here
quizLink = quizDoc.quizLinkDB;
      // Perform calculat = ions and display statistics
      const totalQuestions = quizDoc.numberOfQuestionsDB;
      const correctQuestionNumbers = reviewDataDoc ? reviewDataDoc.correctQuestionNumbers : [];
      const incorrectQuestionNumbers = reviewDataDoc ? reviewDataDoc.incorrectQuestionNumbers : [];




  var totalAttempts;
const userInfo = getUserInfo();
countDocumentsWithQuizCodeAndUserID(quizDoc.quizCodeDB, userInfo.firebaseId)
  .then((totalAttempts) => {
    console.log("attemptsMade:", totalAttempts);

      document.getElementById('totalAttempts').textContent = totalAttempts;

  })
  .catch((error) => {
    console.error("Error:", error);
  });



    }
var quizAttemptCount = 0;
  var tableBody = document.getElementById('questionTableBody');
  var quizSummaryContainer = document.querySelector('.quiz-summary');

    // Function to display the table with quiz statistics
function displayQuizStatsTable(reviewDataDocs, quizDoc) {

  quizSummaryContainer.innerHTML = ''; // Clear previous quiz summary cards

	var questions = [];
		
if(quizDoc.quizJsonDB){
const jsonURL = quizDoc.quizJsonDB;

// Fetch the JSON data using the Fetch API
fetch(jsonURL)
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(jsonData => {
    console.log('JSON data:', jsonData);
    console.log('JSON questions:', jsonData.questions);
questions = jsonData.questions;
	displayQuizStatsTableHTML(reviewDataDocs, questions)  
  })
  .catch(error => {
    console.error('Error fetching JSON:', error);
  });
}else{
const jsonURL = quizDoc.quizDataDB;

// Fetch the JSON data using the Fetch API
fetch(jsonURL)
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    return response.json();
  })
  .then(jsonData => {
    console.log('JSON data:', jsonData);
    console.log('JSON questions:', jsonData.questions);
questions = jsonData.questions;
	displayQuizStatsTableHTML(reviewDataDocs, questions)  
  })
  .catch(error => {
    console.error('Error fetching JSON:', error);
  });


}

}
		  
	function  displayQuizStatsTableHTML(reviewDataDocs, questions){

		
 //   console.log('JSON questions: ', questions[0]);
   // console.log('xx questions: ', questions[0].questions);

if (reviewDataDocs.length === 0) {
  const questionRow = document.createElement('tr');
  questionRow.classList.add('non');
  questionRow.innerHTML = `
    <td class='num2' colspan="3">No Results</td>
  `;
  tableBody.appendChild(questionRow);
} else {
		  
  reviewDataDocs.forEach((reviewDataDoc) => {
    const quizResult = getQuizResultSummary(reviewDataDoc);
    const questionStatInfo = reviewDataDoc.questionStatInfo;
    questionStatInfo.sort((a, b) => a.questionNumber - b.questionNumber);

	  let timeStamp =0, responseTime =0;
    questionStatInfo.forEach((quest) => {
	    if(reviewDataDoc.timeStamp != timeStamp || reviewDataDoc.responseTimeTotal != responseTime){
		    quizAttemptCount++;
		    responseTime = reviewDataDoc.responseTimeTotal;
		    timeStamp = reviewDataDoc.timeStamp;
		          const rowTop = document.createElement('th');
  rowTop.classList.add(  "attempt"+quizAttemptCount);
  rowTop.id = `quiz${quizCountSummary}`; // Set the id

      rowTop.innerHTML = `Quiz Attempt ${quizAttemptCount} `;
		          tableBody.appendChild(rowTop);


	    }
// Assuming you have defined the necessary variables and elements
const questionRow = document.createElement('tr');

if (quest.correctness === "correct") {
  questionRow.classList.add('correct');
  questionRow.innerHTML = `
    <td class='num1'>${quest.questionNumber}</td>
    <td class='num2'>${questions[quest.questionNumber - 1].question}</td>
    <td class='num3'>${formatResponseTime(quest.responseTime)}</td>
    <td class='num4'>${quest.correctness}</td>
  `;
} else {
  questionRow.classList.add('incorrect');
  questionRow.innerHTML = `
    <td>${quest.questionNumber}</td>
    <td>${questions[quest.questionNumber - 1].question}</td>
    <td>${formatResponseTime(quest.responseTime)}</td>
    <td>${quest.correctness}</td>
  `;
}

// Append the click event listener to each question row
questionRow.addEventListener('click', () => {
const popupContainer = document.getElementById('popupContainer');
const popupContent = document.getElementById('popupContent');
	popupContent.innerHTML = '';

  const answerElement = document.createElement('p');
  answerElement.textContent = `Question ${quest.questionNumber} Answer: ${questions[quest.questionNumber - 1].answer}`;
  popupContent.appendChild(answerElement);

  // Show the popup
  popupContainer.style.display = 'flex';
});

		          tableBody.appendChild(questionRow);


		    
    });

    // Create and append quiz summary card
    const quizSummaryCard = createQuizSummaryCard(quizResult);
    quizSummaryContainer.appendChild(quizSummaryCard);
  });
	}
}

  let bestScore = 0;

		  function getBestScore(quizResults) {

    if (quizResults > bestScore) {
      bestScore = quizResults;
    }

  return bestScore;
}

function getQuizResultSummary(reviewDataDoc) {
  const totalQuestions = reviewDataDoc.questionStatInfo.length;
  const counts = reviewDataDoc.questionStatInfo.reduce((accumulator, current) => {
    if (current.correctness === 'correct') {
      accumulator.correct++;
    } else if (current.correctness === 'incorrect') {
      accumulator.incorrect++;
    }
    return accumulator;
  }, { correct: 0, incorrect: 0 });

  const correctResponsesCount = counts.correct;
  const incorrectResponsesCount = counts.incorrect;
  const percentCorrect = (correctResponsesCount / totalQuestions) * 100;
	 
const dateObject = new Date(reviewDataDoc.timeStamp.seconds * 1000); // Convert seconds to milliseconds
const formattedDate = dateObject.toLocaleDateString();

document.getElementById('bestScore').innerHTML = getBestScore(percentCorrect).toFixed(0)+"%"; 
  return {

	
    date: formattedDate,
    percentCorrect: percentCorrect.toFixed(0),
    correctResponses: correctResponsesCount,
    incorrectResponses: incorrectResponsesCount
  };
}
var quizCountSummary = 0;
function createQuizSummaryCard(quizResult) {
quizCountSummary++;
const card = document.createElement('div');
card.classList.add('card', 'quiz-summary-card', "attempt" + quizCountSummary);

card.addEventListener('click', () => {
  // Redirect to the desired URL
  window.location.href = '#quiz' + quizCountSummary; // Concatenate correctly
});

  card.innerHTML = `
    <div class="card-body">
      <h5 class="card-title">Quiz Summary Attempt ${quizCountSummary}</h5>
      <p class="card-text">Date: ${quizResult.date}</p>
      <p class="card-text">Percent Correct: ${quizResult.percentCorrect}%</p>
      <p class="card-text">Correct Responses: ${quizResult.correctResponses}</p>
      <p class="card-text">Incorrect Responses: ${quizResult.incorrectResponses}</p>
    </div>
  `;

  return card;
}


    // Function to format response time in minutes and seconds
    function formatResponseTime(responseTime) {
      const minutes = Math.floor(responseTime / 60000);
      const seconds = Math.floor((responseTime % 60000) / 1000);
      return `${minutes} mins ${seconds} secs`;
    }



async function countDocumentsWithQuizCodeAndUserID(quizCode, userID) {
  try {
	  const db = firebase.firestore();

    const quizReviewDataRef = db.collection('quizReviewData');
    const snapshot = await quizReviewDataRef
      .where('quizCode', '==', quizCode)
      .where('userID', '==', userID)
      .get();

    return snapshot.size;
  } catch (error) {
    console.error('Error counting documents:', error);
    return 0;
  }
}



		  
    // Function to display the score chart
    function displayScoreChart(correctQuestionNumbers, totalQuestions) {
      const averageScore = calculateAverageScore(correctQuestionNumbers, totalQuestions);
      const bestScore = calculateBestScore(correctQuestionNumbers, totalQuestions);

      const ctx = document.getElementById('scoreChart').getContext('2d');
      const scoreChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Average Score', 'Best Score'],
          datasets: [{
            label: 'Score',
            data: [averageScore, bestScore],
            backgroundColor: ['#36A2EB', '#4CAF50'],
          }],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              title: {
                display: true,
                text: 'Percentage (%)',
              },
            },
          },
        },
      });
    }

/*

    Promise.all([getQuizData(quizCode), getQuizReviewData(quizCode)])
      .then(([quizDoc, reviewDataDoc]) => {
        if (quizDoc && reviewDataDoc) {
          displayQuizStats(quizDoc, reviewDataDoc);
          displayQuizStatsTable(reviewDataDoc.questionStatInfo);
         // displayScoreChart(reviewDataDoc.correctQuestionNumbers, quizDoc.numberOfQuestionsDB);
        } else {
          console.log('Quiz or review data not found.');
        }
      });
*/

 // Function to fetch and display quiz data and statistics
  function fetchQuizDataAndStats(quizCode) {
	  const userInfo = getUserInfo();
    Promise.all([getQuizData(quizCode), getQuizReviewData(quizCode, userInfo.firebaseId)])
      .then(([quizDoc, reviewDataDoc]) => {
        if (quizDoc && reviewDataDocs) {
          displayQuizStats(quizDoc, reviewDataDocs);
          displayQuizStatsTable(reviewDataDoc, quizDoc);
      /*    displayScoreChart(
            reviewDataDoc.correctQuestionNumbers,
            quizDoc.numberOfQuestionsDB
          );*/
        } else {
          console.log('Quiz or review data not found.');
        }
      });
  }
</script> 
 </body>
	


</html>
